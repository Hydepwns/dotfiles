# shellcheck disable=all
# Autoload completions
autoload -U compinit
compinit -i

{{ if .ohmyzsh -}}
# Oh My Zsh configuration
export ZSH="{{ .chezmoi.homeDir }}/.oh-my-zsh"

{{ if not .starship -}}
# Set name of the theme to load (disabled when using Starship)
ZSH_THEME="robbyrussell"
{{ else -}}
# Theme disabled - using Starship prompt
ZSH_THEME=""
{{ end }}
# Which plugins would you like to load?
plugins=(git)

source $ZSH/oh-my-zsh.sh
{{ end -}}

# Universal settings
export EDITOR="vim"
export LANG="en_US.UTF-8"

{{ if eq .chezmoi.os "darwin" -}}
# macOS-specific aliases
alias copy="pbcopy"
alias paste="pbpaste"
alias ls="ls -G"
alias flushdns="sudo dscacheutil -flushcache"
{{ else if eq .chezmoi.os "linux" -}}
# Linux-specific aliases
alias copy="xclip -selection clipboard"
alias paste="xclip -selection clipboard -o"
alias ls="ls --color=auto"
alias open="xdg-open"
{{ end }}
# Common aliases
alias ll="ls -la"
alias g="git"
alias cm="chezmoi"

# VS Code integration
code () { VSCODE_CWD="$PWD" open -n -b "com.microsoft.VSCode" --args $* ;}

{{ if eq .chezmoi.os "darwin" -}}
# Ghostty shell integration (primary terminal)
if [[ "$TERM_PROGRAM" == "ghostty" ]]; then
    # Ghostty has built-in shell integration
    :
# Fallback: iTerm2 integration
elif test -e "{{ .chezmoi.homeDir }}/.iterm2_shell_integration.zsh"; then
    source "{{ .chezmoi.homeDir }}/.iterm2_shell_integration.zsh"
fi
{{ else if eq .chezmoi.os "linux" -}}
# Kitty terminal integration
if [[ "$TERM" == "xterm-kitty" ]]; then
    alias icat="kitty +kitten icat"
    alias ssh="kitty +kitten ssh"
fi
{{ end }}
{{ if .nvm -}}
# DappSnap - Automatically use the correct Node.js version
cd() { builtin cd "$@" && if [ -f ".nvmrc" ]; then nvm use; elif [ -d "node_modules" ]; then nvm use 23.4.0; fi }
# Initial setup for current directory
if [ -d "{{ .chezmoi.homeDir }}/Documents/CODE/dappsnap/node_modules" ]; then nvm use 23.4.0; fi
{{ end -}}

{{ if .work -}}
# Work-specific settings
export GIT_AUTHOR_EMAIL="{{ .email }}"
export GIT_COMMITTER_EMAIL="{{ .email }}"
{{ end -}}

# Source modular configuration
source "{{ .chezmoi.homeDir }}/.zsh/modules.zsh"
